

# MTO_TFS相关变量说明



## CostFunction
$$
\begin{align}

&\rm area = |\Omega| \\
&\text {Energy}=\frac12\cdot\frac 12(\nabla \bf U+\nabla \bf U ^T):\bf \sigma\\
&\rm C=\frac{\int Energy\ d\Omega }{C0} \\
&\rm MeanT=\frac{\int T\ d\Omega}{area} \\
&\rm V=\frac{\int x\ d\Omega}{area}-\bar V\\
&\rm powerDiss=\frac{-\int(p+\frac12 {u\cdot u})u\cdot nd\Gamma}{powerDiss0}\\


\end{align}
$$

==**注意：**==程序输出的**C**、**powerDiss**、**V**也是上面的表达式！

## sensitivity

$$
\begin{align}

&\rm gx[0]=\frac{PowerDiss}{max\{PowerDissRelax-0.2*opt\}}-1.0\\
&\rm gx[1]=\frac{C}{max\{CRelax-0.2*opt,CMax\}}-1.0\\
&\rm gx[2]=V

\end{align}
$$

## 数学模型


$$
\begin{align}
&min \ \Psi=\frac 1{|\Omega|}\int T\,d\Omega\\

&s.t. \ 
\begin{cases}

\frac1{|\Omega|}\int x\ d\Omega-\bar V \le 0\\
J-\bar J\le0\left(\frac J{\bar J}-1\le 0\right)\\
C-\bar C\le 0\left(\frac C{\bar C}-1\le 0\right)

\end{cases}


\end{align}
$$


说明：C0，powerDiss0是直管模型的上限:
$$
\rm \bar C=CMax*C0\\
\rm \bar J=PowerDissMax*Powerdiss0
$$


1.3.1 流体拓扑优化
---

- Borrval 等从数学上证明了以最小化能量耗散
为目标函数的流体拓扑优化问题最优解的存在性以及数值求解的收敛性，并指出：不同
于**固体优化中细小结构越多结构柔顺度越低**，在**流体中将一根管道替换成两根较细的管
道反而增加流动能量耗散**。因此这类问题中不需要引入避免数值不稳定的正则方法如过
滤、周长约束等。
- **Othmer** 等以**最小化流体能量耗散**为目标函数拓扑优化设计了输液管连接头；
- **Olesen**^[57]基于COMSOL 平台的自定义偏微分方程(Partial Differential Equation, PDE)工具箱实现了**N-S 流的拓扑优化**。并研究了无量纲**达西数Da**(表征粘性力与多孔介质阻力之比)对流体构型的影响，并指出：达
西数过大会导致优化结果中固体区域处于“可渗透”状态，因此**建议流体问题中达西数应小于等于10^2 。**

1.3.2 流-热-力耦合拓扑优化
---

目前流-热耦合拓扑优化设计仍以传统的**隐式拓扑优化方法**为主，此类方法设计变量大、缺乏结构的显式几何信息。但对于散热器设计这类**边界处存在较大速度和温度梯度**的问题，对**边界进行识别和动态网格加密**具有重要意义。

无量纲数达西数Da 表征了粘性力与多孔介质阻力的比值,Olesen^[57] 探究了Da=10^-3,10^-4, 10^-5时对流体拓扑优化结果的影响，并指出Da=10^-5 可以使固体域流速远小于流体
域，因此保证优化结果的合理性。但对于**流-热问题**来说，~~固体域速度远小于流体域并不能保证固体域对流散热远小于热传导~~，因此需要对流-热问题中Brinkman 方程的适用性展开研究。

1.4 商业及开源软件中拓扑优化功能
---
一些经典代码

- top99^[104]
- levelset88^[105]
- MMC188^[106]

1. 目前商业软件的拓扑优化模块都是针对于固体力学问题，无法处理流体拓扑优化或更为复杂的多物理场耦合问题(注：虽然COMSOL Multiphysics 借助自动微分工具箱能够处理简单几何的流体拓扑优化问题。但存在功能不完善、计算效率低下等问题)；
2. 现有的拓扑优化模块只内置了基于密度的拓扑优化方法，无法实现学界近些年来广泛关注的水平集法和移动组件法等；
3. 商业软件需购买版权，且内部算法对用户隐藏，无法对算法进行研究及扩展。
   

针对上述问题，需要采用开源软件对流体拓扑优化问题进行研究。

1.4.2 开源软件中拓扑优化功能
---
- PETSc (Portable and Extendable Toolkit for Scientific Computing)是由美国Argonne国家实验室开发的可移植、可扩展的科学计算工具箱，主要用于在分布式存储环境高效**求解偏微分方程**及相关问题。PETSc向用户提供了向量(Vec)、矩阵(Mat)、分布式数组(DMDA)等**数据结构**，内置了求解线性方程组的高效求解器，屏蔽了并行通信等诸多并行计算实现细节，很大程度上降低了并行程序开发的复杂度。丹麦技术大学Simgund团队基于PETSc平台实现了**多物理场拓扑优化**，如10亿网格的机翼结构优化问题[115]，自然对流问题[116]，湍流问题[72]等。
- Othmer[54, 117]等在2007年基于OpenFOAM的simpleFOAM求解器编写了纯流动问题的**伴随求解器adjointShapeOptimizationFoam**。本文将在此基础上进行扩展，搭建支持多种拓扑优化方法的多物理场耦合拓扑优化软件。

1.5 本文研究内容
---
第2章中首先介绍了**流体拓扑优化常用的数值方法**，包括基于达西渗流思想的**控制方程**以及**分离式求解算法**；**伴随法敏度分析**流程；**移动渐近线法**；**移动组件法**和**过滤技术**。

第3章中针对**密度法**流-热拓扑优化中无显式边界的问题，研究基于**组件思想**的**二维散热器拓扑优化方法**，提出一种基于二次B样条曲线的可弯组件来描述流道，建立了对于组件参数的敏度分析流程。通过数值算例与密度法进行**对比**，讨论了**组件法**在流道描述领域中模拟和优化方面的独特优势。

第4章中研究了**基于密度法的三维散热器拓扑优化方法**。对于达西数过大时流-热问题中出现的不合理结构进行了分析，并基于固体域内对流散热能力要远小于热传导的原则，研究了流-热问题中达西数的合理取值范围。为保证散热器的承载性能以及避免三维拓扑优化中不切实际的固体悬浮结构，建立了考虑承载性能的散热器拓扑优化方法。通过数值算例归纳总结了考虑和不考虑热膨胀效应下结构的典型特征。此外针对注塑成型冷却系统设计展开初步研究，采用简化模型拓扑优化了球状制品的随形冷却流道。

第5章针对散热器最优设计时流道与热源位置相互耦合的问题，研究了一种密度法描述流道、组件法描述热源的协同拓扑优化方法。对于多个热源具有不同发热功率时初始分布依赖问题，提出了基于目标函数降低必要条件的热源重分布算法和基于线性叠加思想的目标函数快速计算方法。

第6章中介绍了多物理场拓扑优化程序开发。该程序继承了开源软件OpenFOAM的流体模拟能力，并在此基础上开发了支持多种拓扑优化方法、多种物理场耦合的并行拓扑优化模块。

2 拓扑优化中数值方法
===
流体流动是液冷散热器拓扑优化设计中核心问题，以压力修正为代表的**分离式算法**是不可压缩流场求解的主流方法。由于分离式算法在执行时没有**组集总刚**，这会给灵敏度分析带来困难。

- 2.2 节对流体拓扑优化中基本控制方程及数值求解算法进行简介。
- 2.3 节阐述由于N-S 方程分离式求解给敏度分析带来的困难，对比了自动微分工具箱实现离散伴随法和连续伴随法两种解决思路
- 2.4 节中介绍了移动组件法拓扑优化框架
- 2.5 节中介绍了移动渐近线法基本思想

2.2 流体拓扑优化控制方程及数值求解
---
一般将冷却液视为不可压缩流体，其控制方程为稳态不可压
缩N-S 方程。
- 连续性方程
- 动量方程
- 达西渗流理论：增加人工多孔介质阻力项 $$f=-\alpha _fu$$上述方法的优势在于建立了同时描述流体和固体域的流动控制方程，模拟时无需对不同区域进行区分，也无需在流固边界处进行数据传输。
- Brinkman方程：N_S方程加入人工阻力项
- 流阻系数插值模型 : $\alpha和\gamma的插值关系$
- N-S方程求解：SIMPLE算法

2.3 灵敏度分析
---
- 差分法

利用差分思想来计算敏度虽然简单直接，但存在以下问题。
a)扰动要足够小以保证敏度计算对于扰动取值无依赖，因此需要求解器必须完全收敛才能通过差分来捕获目标函数的微小变化。
b)对每一个变量，差分法至少需要求解一次控制方
程来计算敏度。而拓扑优化中变量数通常与网格数正相关，因此也存在维度灾难的问题。
- 直接法

一个包含n个设计变量的优化问题需要求解n次式
- 伴随法
  伴随法又可分为连续伴随法和离散伴随法两种，其区别为对控制方程进行离散和求导的先后次序

  - 离散伴随法
  离散伴随法核心思想为：将离散的控制方程与拉格朗日乘子(即伴随变量)的乘积增广到目标函数上来构造拉格朗日函数。通过求解伴随方程式获得伴随变量λ，再将λ代入式(2.20)即可求得敏度。从上述流程可以看出，一个包含m 个目标(约束)函数的优化问题需要求解m 次伴随方程。
  问题：如果状态方程采用耦合式求解器，上述离散伴随分析中所需的总刚K已在状态方程计算时完成组集，且总刚对设计变量偏导数i K x 可以简单地计算获得。但如果采用2.2 节所述的分离式算法，则总刚在迭代计算过程中并未组集，这给离散伴随分析带来困难。为了解决上述问题有学者利用自动微分算法(AutomaticDifferentiation, AD)来计算敏度[71, 72, 122-124]。其优点在于依靠AD 可以建立起通用的敏度分析流程，用户不必因物理问题和目标函数的改变而大量修改求解器。但其缺点在于AD的使用会使得计算时间和内存需求大大增加[125, 126]。
  - 连续伴随法
  其出发点为：将**连续的状态方程**与**伴随变量**相乘并增广到目标函数上，通过**对拉格朗日函数求导**以及**分部积分**，最终得到**连续形式伴随方程**与**伴随边界条件**。该方法**优点**在于伴随方程和状态方程相对独立，伴随方程求解时只需输入状态方程的计算结果，而并不关心状态方程求解时采用耦合或分离式求解器。该优点和支持自定义PDE 求解器的CAE 软件结合时，可以极大地减少用户在敏度分析方面的编程操作，使得用户可以专注于优化问题本身。连续伴随法**缺点**在于物理问题(即状态方程)或目标函数改变时，需要重新推导新的伴随方程及边界条件。此外还需考虑伴随方程中各项的数值处理方法以保证求解收敛，因此并不具备通用的流程来处理连续伴随敏度分析问题。

## 国际单位制

**[kg  m  s  K  . . .]**

## 热源单位：$W/m^3$

国际单位制：$W=\frac J s=\frac{m \cdot kg\cdot m/s^2 }{s}=kg\cdot m^2 \cdot s^{-3}$ 即    [1 2 -3 0 0 0 0]

## 比热容C单位：$J/(kg\cdot K)$

## 导热系数k单位：$W/(m\cdot K)$

---

## 第一类齐次边界条件：第一类边界且边界值为0

## 第二类齐次边界条件：第二类边界梯度为零，如绝热边界

